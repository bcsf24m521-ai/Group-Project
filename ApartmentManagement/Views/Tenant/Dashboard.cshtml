@{
    ViewData["Title"] = "Tenant Dashboard";
    var tenant = ViewBag.Tenant as ApartmentManagement.Models.Tenant;
    var payments = ViewBag.Payments as List<ApartmentManagement.Models.Payment>;
    var complaints = ViewBag.RecentComplaints as List<ApartmentManagement.Models.Complaint>;
    var bookings = ViewBag.UpcomingVenueBookings as List<ApartmentManagement.Models.VenueBooking>;
}

<div class="container py-5 min-vh-100 bg-light">

    <div class="row mb-5">
        <div class="col-12">
            @if (tenant != null)
            {
                <div class="card border-0 text-white shadow-lg overflow-hidden" style="background: linear-gradient(135deg, #4f46e5 0%, #3b82f6 100%); border-radius: 1rem;">
                    <div class="card-body p-4 p-md-5 position-relative">
                        <div class="position-absolute top-0 end-0 opacity-10 p-3">
                            <i class="bi bi-building" style="font-size: 15rem;"></i>
                        </div>

                        <div class="d-flex flex-column flex-md-row justify-content-between align-items-center position-relative z-1">

                            <div class="text-center text-md-start mb-4 mb-md-0">
                                <h6 class="text-white-50 text-uppercase letter-spacing-2 mb-2 fw-bold">Welcome Back</h6>
                                <h1 class="display-5 fw-bold mb-2">@tenant.User?.FullName</h1>
                                <p class="lead mb-0 opacity-90">
                                    <i class="bi bi-geo-alt-fill me-2"></i> Apt @tenant.Apartment?.ApartmentNumber, @tenant.Apartment?.Building?.Name
                                </p>
                            </div>

                            <div class="d-flex gap-3">
                                <div class="bg-white bg-opacity-10 p-3 rounded-3 border border-white border-opacity-25 text-center min-w-150">
                                    <span class="d-block text-white-50 small text-uppercase fw-bold">Monthly Rent</span>
                                    <span class="h3 fw-bold mb-0">Rs. @tenant.MonthlyRent</span>
                                </div>

                                <div class="bg-white text-primary p-3 rounded-3 border border-white text-center min-w-150 d-flex flex-column justify-content-center">
                                    <a asp-action="Profile" class="text-decoration-none fw-bold stretched-link">
                                        <i class="bi bi-person-circle fs-4 d-block mb-1"></i>
                                        My Profile
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>

    <div class="row g-4 mb-5">

        <div class="col-lg-6">
            <div class="card h-100 border-0 shadow-sm rounded-4">
                <div class="card-header bg-white py-3 px-4 border-bottom border-light d-flex justify-content-between align-items-center">
                    <h5 class="fw-bold m-0 text-dark"><i class="bi bi-credit-card-2-front text-primary me-2"></i>Recent Payments</h5>
                    <a asp-action="Payments" class="btn btn-sm btn-light text-primary fw-bold rounded-pill px-3">History</a>
                </div>
                <div class="list-group list-group-flush">
                    @if (payments != null && payments.Any())
                    {
                        @foreach (var payment in payments.Take(3))
                        {
                            <div class="list-group-item px-4 py-3 border-light hover-bg">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1 fw-bold text-dark">@payment.Type</h6>
                                        <small class="text-muted"><i class="bi bi-calendar3 me-1"></i> @payment.Month.ToString("MMMM yyyy")</small>
                                    </div>
                                    <div class="text-end">
                                        <span class="d-block fw-bold text-success">Rs. @payment.Amount</span>
                                        <span class="badge bg-light text-dark border">@payment.Status</span>
                                    </div>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="text-center py-5 text-muted">
                            <i class="bi bi-wallet2 fs-1 opacity-25"></i>
                            <p class="mt-2 small">No recent payments.</p>
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card h-100 border-0 shadow-sm rounded-4">
                <div class="card-header bg-white py-3 px-4 border-bottom border-light d-flex justify-content-between align-items-center">
                    <h5 class="fw-bold m-0 text-dark"><i class="bi bi-exclamation-triangle text-danger me-2"></i>Complaints</h5>
                    <a asp-action="SubmitComplaint" class="btn btn-sm btn-danger fw-bold rounded-pill px-3">+ Report Issue</a>
                </div>
                <div class="list-group list-group-flush">
                    @if (complaints != null && complaints.Any())
                    {
                        @foreach (var complaint in complaints.Take(3))
                        {
                            <div class="list-group-item px-4 py-3 border-light hover-bg">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div style="max-width: 70%;">
                                        <h6 class="mb-1 fw-bold text-truncate">@complaint.Title</h6>
                                        <small class="text-muted"><i class="bi bi-clock me-1"></i> @complaint.ComplaintDate.ToString("MMM dd")</small>
                                    </div>
                                    @{
                                        var badgeColor = complaint.Status.ToString() == "Resolved" ? "bg-success" :
                                        complaint.Status.ToString() == "InProgress" ? "bg-info text-dark" : "bg-warning text-dark";
                                    }
                                    <span class="badge @badgeColor rounded-pill">@complaint.Status</span>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="text-center py-5 text-muted">
                            <i class="bi bi-emoji-smile fs-1 opacity-25"></i>
                            <p class="mt-2 small">No active complaints.</p>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card border-0 shadow-sm rounded-4">
                <div class="card-header bg-white py-3 px-4 border-0 d-flex justify-content-between align-items-center">
                    <h5 class="fw-bold m-0 text-dark"><i class="bi bi-calendar-check text-success me-2"></i>Upcoming Events</h5>
                    <a asp-action="BookVenue" class="btn btn-sm btn-success fw-bold rounded-pill px-3">Book Venue</a>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="bg-light text-secondary text-uppercase small fw-bold">
                                <tr>
                                    <th class="ps-4 py-3">Venue</th>
                                    <th>Date</th>
                                    <th>Time</th>
                                    <th>Purpose</th>
                                    <th class="text-center">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (bookings != null && bookings.Any())
                                {
                                    @foreach (var booking in bookings)
                                    {
                                        <tr>
                                            <td class="ps-4 fw-bold text-dark">
                                                <span class="d-inline-block bg-success bg-opacity-10 text-success rounded-circle p-1 me-2 text-center" style="width: 30px; height: 30px;">
                                                    <i class="bi bi-geo-fill small"></i>
                                                </span>
                                                @booking.VenueType
                                            </td>
                                            <td>@booking.BookingDate.ToString("MMM dd, yyyy")</td>
                                            <td>@booking.BookingTime</td>
                                            <td class="text-muted">@booking.Purpose</td>
                                            <td class="text-center">
                                                @{
                                                    var bookingBadge = booking.Status.ToString() switch
                                                    {
                                                        "Approved" => "bg-success",
                                                        "Rejected" => "bg-danger",
                                                        "Completed" => "bg-secondary",
                                                        _ => "bg-warning text-dark"
                                                    };
                                                }
                                                <span class="badge @bookingBadge rounded-pill">@booking.Status</span>
                                            </td>
                                        </tr>
                                    }
                                }
                                else
                                {
                                    <tr>
                                        <td colspan="5" class="text-center py-5 text-muted">
                                            <i class="bi bi-calendar-x fs-4 d-block mb-2 opacity-50"></i>
                                            No upcoming bookings found.
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .hover-bg:hover {
        background-color: #f8f9fa;
        transition: 0.2s;
    }

    .min-w-150 {
        min-width: 150px;
    }

    .letter-spacing-2 {
        letter-spacing: 2px;
    }
</style>